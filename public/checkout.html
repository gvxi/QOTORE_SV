<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Checkout - Qotor</title>
    <styple>
        :root {
    --primary-color: #1a237e;
    --primary-light: #3949ab;
    --secondary-color: #ffd700;
    --text-primary: #212121;
    --text-secondary: #757575;
    --background: #ffffff;
    --surface: #f8fafc;
    --border: #e0e0e0;
    --success: #4caf50;
    --error: #f44336;
    --warning: #ff9800;
    --spacing-xs: 0.25rem;
    --spacing-sm: 0.5rem;
    --spacing-md: 1rem;
    --spacing-lg: 1.5rem;
    --spacing-xl: 2rem;
    --spacing-xxl: 3rem;
    --radius-sm: 4px;
    --radius-md: 8px;
    --radius-lg: 12px;
    --radius-xl: 16px;
    --transition: 0.3s ease;
    --shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    --shadow-lg: 0 8px 32px rgba(0, 0, 0, 0.15);
}

* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: 'Arial', sans-serif;
    line-height: 1.6;
    color: var(--text-primary);
    background: var(--surface);
    direction: ltr;
}

body.rtl {
    direction: rtl;
}

/* Header */
.header {
    background: var(--primary-color);
    color: white;
    padding: var(--spacing-md) 0;
    position: sticky;
    top: 0;
    z-index: 1000;
    box-shadow: var(--shadow);
}

.nav-container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 var(--spacing-lg);
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.logo-section {
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
}

.logo-image {
    height: 40px;
    width: auto;
}

.logo {
    font-size: 1.8rem;
    font-weight: bold;
    color: var(--secondary-color);
}

.nav-actions {
    display: flex;
    align-items: center;
    gap: var(--spacing-md);
}

.language-switcher {
    position: relative;
}

.lang-btn {
    background: rgba(255, 255, 255, 0.1);
    border: 2px solid rgba(255, 255, 255, 0.2);
    color: white;
    padding: var(--spacing-sm) var(--spacing-md);
    border-radius: var(--radius-md);
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: var(--spacing-xs);
    font-size: 0.9rem;
    font-weight: 500;
    transition: var(--transition);
}

.lang-btn:hover {
    background: rgba(255, 255, 255, 0.2);
    border-color: var(--secondary-color);
}

.lang-btn img {
    width: 16px;
    height: 16px;
    filter: brightness(0) invert(1);
}

.back-btn {
    background: rgba(255, 255, 255, 0.1);
    border: 2px solid rgba(255, 255, 255, 0.2);
    color: white;
    padding: var(--spacing-sm) var(--spacing-md);
    border-radius: var(--radius-md);
    text-decoration: none;
    display: flex;
    align-items: center;
    gap: var(--spacing-xs);
    font-weight: 500;
    transition: var(--transition);
}

.back-btn:hover {
    background: rgba(255, 255, 255, 0.2);
    border-color: var(--secondary-color);
}

.back-btn img {
    width: 16px;
    height: 16px;
    filter: brightness(0) invert(1);
}

/* Progress Steps */
.progress-section {
    background: var(--background);
    padding: var(--spacing-lg) 0;
    border-bottom: 1px solid var(--border);
}

.progress-container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 var(--spacing-lg);
}

.progress-steps {
    display: flex;
    align-items: center;
    justify-content: center;
    max-width: 600px;
    margin: 0 auto;
}

.step {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: var(--spacing-sm);
    transition: var(--transition);
}

.step-number {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background: var(--border);
    color: var(--text-secondary);
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: bold;
    transition: var(--transition);
}

.step.active .step-number {
    background: var(--primary-color);
    color: white;
}

.step.completed .step-number {
    background: var(--success);
    color: white;
}

.step-label {
    font-size: 0.875rem;
    color: var(--text-secondary);
    font-weight: 500;
    text-align: center;
}

.step.active .step-label {
    color: var(--primary-color);
    font-weight: bold;
}

.step-line {
    flex: 1;
    height: 2px;
    background: var(--border);
    margin: 0 var(--spacing-md);
    min-width: 40px;
}

/* Main Container */
.container {
    max-width: 1200px;
    margin: 0 auto;
    padding: var(--spacing-xl);
    display: grid;
    grid-template-columns: 1fr 400px;
    gap: var(--spacing-xl);
    align-items: start;
}

/* Checkout Form */
.checkout-form {
    background: var(--background);
    padding: var(--spacing-xxl);
    border-radius: var(--radius-xl);
    box-shadow: var(--shadow-lg);
}

/* Message Display */
.message {
    padding: var(--spacing-md);
    border-radius: var(--radius-lg);
    margin-bottom: var(--spacing-lg);
    display: none;
    align-items: center;
    gap: var(--spacing-sm);
    font-weight: 500;
}

.message.show {
    display: flex;
}

.message.success {
    background: rgba(76, 175, 80, 0.1);
    color: var(--success);
    border: 1px solid rgba(76, 175, 80, 0.3);
}

.message.error {
    background: rgba(244, 67, 54, 0.1);
    color: var(--error);
    border: 1px solid rgba(244, 67, 54, 0.3);
}

.message.warning {
    background: rgba(255, 152, 0, 0.1);
    color: var(--warning);
    border: 1px solid rgba(255, 152, 0, 0.3);
}

/* Form Steps */
.form-step {
    display: none;
}

.form-step.active {
    display: block;
}

.step-header {
    display: flex;
    align-items: center;
    gap: var(--spacing-lg);
    margin-bottom: var(--spacing-xxl);
    padding-bottom: var(--spacing-lg);
    border-bottom: 2px solid var(--border);
}

.step-icon {
    width: 60px;
    height: 60px;
    background: var(--primary-color);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
}

.step-icon img {
    width: 30px;
    height: 30px;
    filter: brightness(0) invert(1);
}

.step-info {
    flex: 1;
}

.step-title {
    font-size: 1.75rem;
    color: var(--text-primary);
    margin-bottom: var(--spacing-sm);
    font-weight: bold;
}

.step-subtitle {
    color: var(--text-secondary);
    font-size: 1.1rem;
}

/* Form Styles */
.form-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: var(--spacing-lg);
}

.form-group {
    display: flex;
    flex-direction: column;
    gap: var(--spacing-sm);
}

.form-group.full-width {
    grid-column: 1 / -1;
}

.form-label {
    font-weight: 600;
    color: var(--text-primary);
    font-size: 0.95rem;
    display: flex;
    align-items: center;
    gap: var(--spacing-xs);
}

.label-icon {
    width: 16px;
    height: 16px;
    opacity: 0.7;
}

.form-input, .form-textarea, .form-select {
    width: 100%;
    padding: var(--spacing-md);
    border: 2px solid var(--border);
    border-radius: var(--radius-lg);
    font-size: 1rem;
    background: var(--background);
    color: var(--text-primary);
    transition: var(--transition);
    font-family: inherit;
}

.form-input:focus, .form-textarea:focus, .form-select:focus {
    outline: none;
    border-color: var(--primary-color);
    box-shadow: 0 0 0 3px rgba(26, 35, 126, 0.1);
}

.form-textarea {
    min-height: 100px;
    resize: vertical;
}

.form-select {
    cursor: pointer;
}

/* Buttons */
.btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: var(--spacing-sm);
    padding: var(--spacing-md) var(--spacing-xl);
    border: none;
    border-radius: var(--radius-lg);
    font-size: 1rem;
    font-weight: 600;
    cursor: pointer;
    transition: var(--transition);
    text-decoration: none;
    min-height: 48px;
}

.btn img {
    width: 18px;
    height: 18px;
}

.btn-primary {
    background: var(--primary-color);
    color: white;
}

.btn-primary:hover {
    background: var(--primary-light);
    transform: translateY(-2px);
    box-shadow: var(--shadow);
}

.btn-primary img {
    filter: brightness(0) invert(1);
}

.btn-secondary {
    background: var(--surface);
    color: var(--text-primary);
    border: 2px solid var(--border);
}

.btn-secondary:hover {
    background: var(--border);
    border-color: var(--primary-color);
}

.btn-success {
    background: var(--success);
    color: white;
}

.btn-success:hover {
    background: #45a049;
    transform: translateY(-2px);
    box-shadow: var(--shadow);
}

.btn-success img {
    filter: brightness(0) invert(1);
}

.btn:disabled {
    opacity: 0.6;
    cursor: not-allowed;
    transform: none !important;
}

.form-actions {
    display: flex;
    gap: var(--spacing-md);
    justify-content: flex-end;
    margin-top: var(--spacing-xl);
}

.form-actions.full-width {
    grid-column: 1 / -1;
}

/* Review Sections */
.review-section {
    margin-bottom: var(--spacing-xl);
}

.section-title {
    font-size: 1.25rem;
    font-weight: 600;
    color: var(--text-primary);
    margin-bottom: var(--spacing-lg);
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
}

.section-icon {
    width: 20px;
    height: 20px;
    opacity: 0.7;
}

.review-card {
    background: var(--surface);
    padding: var(--spacing-lg);
    border-radius: var(--radius-lg);
    border: 1px solid var(--border);
    margin-bottom: var(--spacing-md);
}

.review-detail {
    display: flex;
    justify-content: space-between;
    padding: var(--spacing-sm) 0;
    border-bottom: 1px solid var(--border);
}

.review-detail:last-child {
    border-bottom: none;
}

.review-label {
    font-weight: 600;
    color: var(--text-secondary);
}

.review-value {
    color: var(--text-primary);
    text-align: right;
}

.edit-btn {
    margin-bottom: var(--spacing-lg);
}

/* Order Items Review */
.order-items-review {
    background: var(--surface);
    border-radius: var(--radius-lg);
    overflow: hidden;
    border: 1px solid var(--border);
}

.review-item {
    display: flex;
    align-items: center;
    gap: var(--spacing-md);
    padding: var(--spacing-lg);
    border-bottom: 1px solid var(--border);
}

.review-item:last-child {
    border-bottom: none;
}

.review-item-image {
    width: 60px;
    height: 60px;
    border-radius: var(--radius-md);
    overflow: hidden;
    flex-shrink: 0;
    background: var(--background);
    display: flex;
    align-items: center;
    justify-content: center;
}

.review-item-image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

.review-item-details {
    flex: 1;
}

.review-item-name {
    font-weight: 600;
    margin-bottom: var(--spacing-xs);
}

.review-item-variant {
    color: var(--text-secondary);
    font-size: 0.875rem;
}

.review-item-price {
    font-weight: 600;
    color: var(--primary-color);
    font-size: 1.1rem;
}

/* Success Content */
.success-content {
    text-align: center;
    padding: var(--spacing-xxl) 0;
}

.success-icon {
    width: 100px;
    height: 100px;
    margin: 0 auto var(--spacing-xl);
    background: var(--success);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
}

.success-icon img {
    width: 50px;
    height: 50px;
    filter: brightness(0) invert(1);
}

.success-title {
    font-size: 2.5rem;
    color: var(--success);
    margin-bottom: var(--spacing-lg);
    font-weight: bold;
}

.success-message {
    font-size: 1.25rem;
    color: var(--text-secondary);
    margin-bottom: var(--spacing-xl);
    line-height: 1.6;
}

.success-details {
    background: var(--surface);
    padding: var(--spacing-xl);
    border-radius: var(--radius-lg);
    margin: var(--spacing-xl) 0;
    text-align: left;
}

.success-details h4 {
    font-size: 1.1rem;
    margin-bottom: var(--spacing-lg);
    color: var(--text-primary);
    text-align: center;
}

.success-steps {
    list-style: none;
    display: flex;
    flex-direction: column;
    gap: var(--spacing-md);
}

.success-steps li {
    display: flex;
    align-items: center;
    gap: var(--spacing-md);
    padding: var(--spacing-md);
    background: var(--background);
    border-radius: var(--radius-md);
    border: 1px solid var(--border);
}

.success-steps li img {
    width: 24px;
    height: 24px;
    opacity: 0.7;
}

.success-actions {
    display: flex;
    gap: var(--spacing-md);
    justify-content: center;
    flex-wrap: wrap;
}

/* Order Summary Sidebar */
.order-summary {
    background: var(--background);
    padding: var(--spacing-xl);
    border-radius: var(--radius-xl);
    box-shadow: var(--shadow-lg);
    height: fit-content;
    position: sticky;
    top: calc(60px + var(--spacing-xl));
}

.summary-header {
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
    margin-bottom: var(--spacing-lg);
    padding-bottom: var(--spacing-lg);
    border-bottom: 2px solid var(--border);
}

.summary-icon {
    width: 24px;
    height: 24px;
    opacity: 0.7;
}

.summary-title {
    font-size: 1.25rem;
    font-weight: 600;
    color: var(--text-primary);
}

/* Cart Items in Summary */
.cart-items {
    margin-bottom: var(--spacing-lg);
}

.cart-item {
    display: flex;
    align-items: center;
    gap: var(--spacing-md);
    padding: var(--spacing-md) 0;
    border-bottom: 1px solid var(--border);
}

.cart-item:last-child {
    border-bottom: none;
}

.cart-item-image {
    width: 50px;
    height: 50px;
    border-radius: var(--radius-md);
    overflow: hidden;
    flex-shrink: 0;
    background: var(--surface);
    display: flex;
    align-items: center;
    justify-content: center;
}

.cart-item-image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

.cart-item-details {
    flex: 1;
}

.cart-item-name {
    font-weight: 600;
    margin-bottom: var(--spacing-xs);
    font-size: 0.9rem;
    line-height: 1.3;
}

.cart-item-variant {
    color: var(--text-secondary);
    font-size: 0.8rem;
}

.cart-item-price {
    font-weight: 600;
    color: var(--primary-color);
    font-size: 0.9rem;
}

/* Empty Cart */
.empty-cart {
    text-align: center;
    padding: var(--spacing-xl);
    color: var(--text-secondary);
}

.empty-icon {
    width: 60px;
    height: 60px;
    margin-bottom: var(--spacing-md);
    opacity: 0.5;
}

.return-btn {
    display: inline-flex;
    align-items: center;
    gap: var(--spacing-sm);
    padding: var(--spacing-md) var(--spacing-lg);
    background: var(--primary-color);
    color: white;
    text-decoration: none;
    border-radius: var(--radius-md);
    margin-top: var(--spacing-md);
    transition: var(--transition);
}

.return-btn:hover {
    background: var(--primary-light);
}

.return-btn img {
    width: 16px;
    height: 16px;
    filter: brightness(0) invert(1);
}

/* Order Total */
.order-total {
    border-top: 1px solid var(--border);
    padding-top: var(--spacing-lg);
    margin-bottom: var(--spacing-lg);
}

.total-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: var(--spacing-sm);
    font-size: 0.95rem;
}

.total-row.subtotal {
    color: var(--text-secondary);
}

.total-row.delivery {
    color: var(--text-secondary);
}

.delivery-note {
    display: flex;
    align-items: center;
    gap: var(--spacing-xs);
    color: var(--success);
    font-weight: 600;
}

.delivery-note img {
    width: 14px;
    height: 14px;
}

.total-row.final-total {
    font-size: 1.2rem;
    font-weight: bold;
    color: var(--primary-color);
    margin-top: var(--spacing-md);
    padding-top: var(--spacing-md);
    border-top: 2px solid var(--border);
}

/* Trust Indicators */
.trust-indicators {
    border-top: 1px solid var(--border);
    padding-top: var(--spacing-lg);
}

.trust-item {
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
    margin-bottom: var(--spacing-sm);
    font-size: 0.875rem;
    color: var(--text-secondary);
}

.trust-item:last-child {
    margin-bottom: 0;
}

.trust-icon {
    width: 16px;
    height: 16px;
    opacity: 0.7;
}

/* Footer */
.footer {
    background: var(--text-primary);
    color: white;
    padding: var(--spacing-xl) 0;
    margin-top: var(--spacing-xxl);
}

.footer-content {
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 var(--spacing-lg);
    text-align: center;
}

.footer-logo {
    font-size: 1.5rem;
    font-weight: bold;
    margin-bottom: var(--spacing-md);
    display: flex;
    align-items: center;
    justify-content: center;
    gap: var(--spacing-sm);
}

.footer-logo img {
    width: 30px;
    height: 30px;
}

.footer-contact {
    margin: var(--spacing-lg) 0;
}

.social-links {
    display: flex;
    justify-content: center;
    gap: var(--spacing-md);
    margin: var(--spacing-lg) 0;
}

.social-link {
    background: var(--primary-color);
    color: white;
    padding: var(--spacing-sm);
    border-radius: 50%;
    text-decoration: none;
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: var(--transition);
}

.social-link:hover {
    background: var(--primary-light);
}

.social-link img {
    width: 20px;
    height: 20px;
    filter: brightness(0) invert(1);
}

/* Floating WhatsApp Button */
.whatsapp-float {
    position: fixed;
    bottom: 20px;
    right: 20px;
    background: #25d366;
    color: white;
    width: 60px;
    height: 60px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    text-decoration: none;
    box-shadow: 0 4px 15px rgba(37, 211, 102, 0.3);
    z-index: 1000;
    transition: var(--transition);
}

.whatsapp-float:hover {
    transform: scale(1.1);
}

.whatsapp-float img {
    width: 30px;
    height: 30px;
    filter: brightness(0) invert(1);
}

/* RTL Support */
body.rtl .nav-container {
    direction: rtl;
}

body.rtl .form-grid {
    direction: rtl;
}

body.rtl .review-detail {
    flex-direction: row-reverse;
}

body.rtl .review-value {
    text-align: left;
}

body.rtl .total-row {
    flex-direction: row-reverse;
}

body.rtl .step-header {
    flex-direction: row-reverse;
    text-align: right;
}

/* Responsive Design */
@media (max-width: 768px) {
    .container {
        grid-template-columns: 1fr;
        padding: var(--spacing-md);
        gap: var(--spacing-lg);
    }

    .order-summary {
        order: -1;
        position: static;
    }

    .checkout-form {
        padding: var(--spacing-lg);
    }

    .form-grid {
        grid-template-columns: 1fr;
        gap: var(--spacing-md);
    }

    .form-actions {
        flex-direction: column;
    }

    .step-header {
        flex-direction: column;
        text-align: center;
        gap: var(--spacing-md);
    }

    .step-title {
        font-size: 1.5rem;
    }

    .success-title {
        font-size: 2rem;
    }

    .success-actions {
        flex-direction: column;
    }

    .progress-steps {
        flex-direction: column;
        gap: var(--spacing-md);
    }

    .step-line {
        width: 2px;
        height: 40px;
        margin: var(--spacing-md) 0;
        min-width: auto;
    }
}

@media (max-width: 480px) {
    .nav-container {
        flex-direction: column;
        gap: var(--spacing-md);
    }

    .nav-actions {
        width: 100%;
        justify-content: space-between;
    }

    .container {
        padding: var(--spacing-sm);
    }

    .checkout-form {
        padding: var(--spacing-md);
    }

    .step-title {
        font-size: 1.25rem;
    }

    .success-title {
        font-size: 1.75rem;
    }

    .btn {
        padding: var(--spacing-md);
        font-size: 0.9rem;
    }
}
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <nav class="nav-container">
            <div class="logo-section">
                <img src="/api/image/logo.png" alt="Qotor" class="logo-image" onerror="this.style.display='none';">
                <div class="logo">Qotor</div>
            </div>
            
            <div class="nav-actions">
                <!-- Language Switcher -->
                <div class="language-switcher">
                    <button class="lang-btn" onclick="toggleLanguage()" id="langBtn">
                        <img src="/api/image/language-icon.png" alt="Language" onerror="this.textContent='ðŸŒ';">
                        <span id="currentLang">EN</span>
                    </button>
                </div>
                
                <!-- Back to Store -->
                <a href="/" class="back-btn">
                    <img src="/api/image/back-icon.png" alt="Back" onerror="this.textContent='â†';">
                    <span data-key="back_to_store">Back to Store</span>
                </a>
            </div>
        </nav>
    </header>

    <!-- Progress Steps -->
    <section class="progress-section">
        <div class="progress-container">
            <div class="progress-steps">
                <div class="step active" id="step1Progress">
                    <div class="step-number">1</div>
                    <span class="step-label" data-key="customer_details">Customer Details</span>
                </div>
                <div class="step-line"></div>
                <div class="step" id="step2Progress">
                    <div class="step-number">2</div>
                    <span class="step-label" data-key="review_order">Review Order</span>
                </div>
                <div class="step-line"></div>
                <div class="step" id="step3Progress">
                    <div class="step-number">3</div>
                    <span class="step-label" data-key="confirmation">Confirmation</span>
                </div>
            </div>
        </div>
    </section>

    <!-- Main Container -->
    <div class="container">
        <!-- Checkout Form -->
        <div class="checkout-form">
            <!-- Message Display -->
            <div id="message" class="message"></div>

            <!-- Step 1: Customer Details -->
            <div class="form-step active" id="step1">
                <div class="step-header">
                    <div class="step-icon">
                        <img src="/api/image/user-icon.png" alt="User" onerror="this.textContent='ðŸ‘¤';">
                    </div>
                    <div class="step-info">
                        <h2 class="step-title" data-key="customer_information">Customer Information</h2>
                        <p class="step-subtitle" data-key="fill_details_below">Please fill in your details below</p>
                    </div>
                </div>

                <form id="customerForm" class="form-grid">
                    <div class="form-group">
                        <label class="form-label" for="fullName">
                            <img src="/api/image/user-icon.png" alt="Name" class="label-icon" onerror="this.style.display='none';">
                            <span data-key="full_name">Full Name</span> *
                        </label>
                        <input type="text" id="fullName" class="form-input" required 
                               placeholder="Enter your full name" data-key-placeholder="full_name_placeholder">
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="email">
                            <img src="/api/image/email-icon.png" alt="Email" class="label-icon" onerror="this.style.display='none';">
                            <span data-key="email_address">Email Address</span> *
                        </label>
                        <input type="email" id="email" class="form-input" required 
                               placeholder="Enter your email address" data-key-placeholder="email_placeholder">
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="phone">
                            <img src="/api/image/phone-icon.png" alt="Phone" class="label-icon" onerror="this.style.display='none';">
                            <span data-key="phone_number">Phone Number</span> *
                        </label>
                        <input type="tel" id="phone" class="form-input" required 
                               placeholder="Enter your phone number" data-key-placeholder="phone_placeholder">
                    </div>

                    <div class="form-group full-width">
                        <label class="form-label" for="address">
                            <img src="/api/image/location-icon.png" alt="Address" class="label-icon" onerror="this.style.display='none';">
                            <span data-key="delivery_address">Delivery Address</span> *
                        </label>
                        <textarea id="address" class="form-textarea" required 
                                  placeholder="Enter your full delivery address" data-key-placeholder="delivery_address_placeholder"></textarea>
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="deliveryTime">
                            <img src="/api/image/clock-icon.png" alt="Time" class="label-icon" onerror="this.style.display='none';">
                            <span data-key="preferred_delivery_time">Preferred Delivery Time</span>
                        </label>
                        <select id="deliveryTime" class="form-select">
                            <option value="" data-key="select_time">Select preferred time</option>
                            <option value="morning" data-key="morning">Morning (9 AM - 12 PM)</option>
                            <option value="afternoon" data-key="afternoon">Afternoon (12 PM - 6 PM)</option>
                            <option value="evening" data-key="evening">Evening (6 PM - 9 PM)</option>
                            <option value="anytime" data-key="anytime">Anytime</option>
                        </select>
                    </div>

                    <div class="form-group full-width">
                        <label class="form-label" for="instructions">
                            <img src="/api/image/note-icon.png" alt="Notes" class="label-icon" onerror="this.style.display='none';">
                            <span data-key="special_instructions">Special Instructions</span>
                        </label>
                        <textarea id="instructions" class="form-textarea" 
                                  placeholder="Any special delivery instructions..." data-key-placeholder="special_instructions_placeholder"></textarea>
                    </div>

                    <div class="form-actions full-width">
                        <button type="button" class="btn btn-primary" onclick="continueToReview()">
                            <span data-key="continue_to_review">Continue to Review</span>
                            <img src="/api/image/arrow-right-icon.png" alt="Continue" onerror="this.textContent='â†’';">
                        </button>
                    </div>
                </form>
            </div>

            <!-- Step 2: Review Order -->
            <div class="form-step" id="step2">
                <div class="step-header">
                    <div class="step-icon">
                        <img src="/api/image/review-icon.png" alt="Review" onerror="this.textContent='ðŸ‘ï¸';">
                    </div>
                    <div class="step-info">
                        <h2 class="step-title" data-key="review_your_order">Review Your Order</h2>
                        <p class="step-subtitle" data-key="review_before_confirm">Please review your order details before confirming</p>
                    </div>
                </div>

                <!-- Customer Review -->
                <div class="review-section">
                    <h3 class="section-title">
                        <img src="/api/image/user-icon.png" alt="Customer" class="section-icon" onerror="this.style.display='none';">
                        <span data-key="customer_details">Customer Details</span>
                    </h3>
                    <div id="customerReview" class="review-card">
                        <!-- Customer details will be populated here -->
                    </div>
                    <button type="button" class="btn btn-secondary edit-btn" onclick="editDetails()">
                        <img src="/api/image/edit-icon.png" alt="Edit" onerror="this.textContent='âœï¸';">
                        <span data-key="edit_details">Edit Details</span>
                    </button>
                </div>

                <!-- Order Review -->
                <div class="review-section">
                    <h3 class="section-title">
                        <img src="/api/image/package-icon.png" alt="Items" class="section-icon" onerror="this.style.display='none';">
                        <span data-key="order_items">Order Items</span>
                    </h3>
                    <div id="orderReview" class="order-items-review">
                        <!-- Order items will be populated here -->
                    </div>
                </div>

                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="backToDetails()">
                        <img src="/api/image/arrow-left-icon.png" alt="Back" onerror="this.textContent='â†';">
                        <span data-key="back_to_details">Back to Details</span>
                    </button>
                    <button type="button" class="btn btn-success" onclick="confirmOrder()" id="confirmOrderBtn">
                        <img src="/api/image/check-icon.png" alt="Confirm" onerror="this.textContent='âœ“';">
                        <span data-key="confirm_order">Confirm Order</span>
                    </button>
                </div>
            </div>

            <!-- Step 3: Success Page -->
            <div class="form-step" id="step3">
                <div class="success-content">
                    <div class="success-icon">
                        <img src="/api/image/success-icon.png" alt="Success" onerror="this.textContent='âœ…';">
                    </div>
                    <h2 class="success-title" data-key="order_confirmed">Order Confirmed!</h2>
                    <p class="success-message" data-key="order_success_message">
                        Thank you for your order. We'll contact you shortly to confirm delivery details.
                    </p>
                    
                    <div class="success-details">
                        <h4 data-key="what_happens_next">What happens next:</h4>
                        <ul class="success-steps">
                            <li>
                                <img src="/api/image/clock-icon.png" alt="Time" onerror="this.style.display='none';">
                                <span data-key="step_contact">We'll contact you within 24 hours</span>
                            </li>
                            <li>
                                <img src="/api/image/package-icon.png" alt="Package" onerror="this.style.display='none';">
                                <span data-key="step_prepare">We'll prepare your fragrances</span>
                            </li>
                            <li>
                                <img src="/api/image/delivery-icon.png" alt="Delivery" onerror="this.style.display='none';">
                                <span data-key="step_deliver">Fast delivery to your address</span>
                            </li>
                        </ul>
                    </div>
                    
                    <div class="success-actions">
                        <a href="/" class="btn btn-primary">
                            <img src="/api/image/shop-icon.png" alt="Shop" onerror="this.style.display='none';">
                            <span data-key="continue_shopping">Continue Shopping</span>
                        </a>
                        <button class="btn btn-secondary" onclick="shareOrder()">
                            <img src="/api/image/share-icon.png" alt="Share" onerror="this.style.display='none';">
                            <span data-key="share_order">Share Order</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Order Summary Sidebar -->
        <div class="order-summary">
            <div class="summary-header">
                <img src="/api/image/cart-icon.png" alt="Cart" class="summary-icon" onerror="this.style.display='none';">
                <h3 class="summary-title" data-key="order_summary">Order Summary</h3>
            </div>
            
            <div class="summary-content">
                <!-- Cart Items -->
                <div class="cart-items" id="cartItems">
                    <!-- Items will be populated here -->
                </div>

                <!-- Empty Cart -->
                <div id="emptyCart" class="empty-cart" style="display: none;">
                    <img src="/api/image/empty-cart-icon.png" alt="Empty Cart" class="empty-icon" onerror="this.style.display='none';">
                    <h4 data-key="no_items_cart">No items in cart</h4>
                    <p data-key="add_items_first">Please add items to your cart first</p>
                    <a href="/" class="return-btn">
                        <img src="/api/image/shop-icon.png" alt="Shop" onerror="this.style.display='none';">
                        <span data-key="browse_fragrances">Browse Fragrances</span>
                    </a>
                </div>

                <!-- Order Total -->
                <div class="order-total" id="orderTotal" style="display: none;">
                    <div class="total-row subtotal">
                        <span data-key="subtotal">Subtotal</span>
                        <span id="subtotalAmount">0.000 OMR</span>
                    </div>
                    <div class="total-row delivery">
                        <span data-key="delivery_fee">Delivery Fee</span>
                        <span class="delivery-note">
                            <img src="/api/image/free-icon.png" alt="Free" onerror="this.style.display='none';">
                            <span data-key="free_delivery">Free</span>
                        </span>
                    </div>
                    <div class="total-row final-total">
                        <span data-key="total">Total</span>
                        <span id="totalAmount">0.000 OMR</span>
                    </div>
                </div>

                <!-- Trust Indicators -->
                <div class="trust-indicators">
                    <div class="trust-item">
                        <img src="/api/image/authentic-icon.png" alt="Authentic" class="trust-icon" onerror="this.textContent='âœ“';">
                        <span data-key="authentic_products">100% Authentic</span>
                    </div>
                    <div class="trust-item">
                        <img src="/api/image/delivery-icon.png" alt="Delivery" class="trust-icon" onerror="this.textContent='ðŸšš';">
                        <span data-key="fast_delivery">Fast Delivery</span>
                    </div>
                    <div class="trust-item">
                        <img src="/api/image/secure-icon.png" alt="Secure" class="trust-icon" onerror="this.textContent='ðŸ”’';">
                        <span data-key="secure_checkout">Secure Checkout</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-content">
            <div class="footer-logo">
                <img src="/api/image/logo-white.png" alt="Qotor" onerror="this.style.display='none';">
                <span>Qotor</span>
            </div>
            <p data-key="footer_tagline">Premium fragrances for discerning tastes</p>
            
            <div class="social-links">
                <a href="https://instagram.com/qotor" class="social-link" target="_blank">
                    <img src="/api/image/instagram-icon.png" alt="Instagram" onerror="this.textContent='ðŸ“·';">
                </a>
                <a href="https://snapchat.com/add/qotor" class="social-link" target="_blank">
                    <img src="/api/image/snapchat-icon.png" alt="Snapchat" onerror="this.textContent='ðŸ‘»';">
                </a>
                <a href="https://wa.me/96812345678" class="social-link" target="_blank">
                    <img src="/api/image/whatsapp-icon.png" alt="WhatsApp" onerror="this.textContent='ðŸ’¬';">
                </a>
            </div>
            
            <div class="footer-contact">
                <p data-key="footer_contact">Contact: info@qotor.com</p>
                <p data-key="footer_copyright">&copy; 2024 Qotor. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <!-- Floating WhatsApp -->
    <a href="https://wa.me/96812345678" class="whatsapp-float" target="_blank">
        <img src="/api/image/whatsapp-icon.png" alt="WhatsApp" onerror="this.textContent='ðŸ’¬';">
    </a>

    <script>
        // Global variables
let cart = [];
let customerData = {};
let currentStep = 1;
let currentLanguage = 'en';

// Language translations
const translations = {
    en: {
        back_to_store: 'Back to Store',
        customer_details: 'Customer Details',
        review_order: 'Review Order',
        confirmation: 'Confirmation',
        customer_information: 'Customer Information',
        fill_details_below: 'Please fill in your details below',
        full_name: 'Full Name',
        full_name_placeholder: 'Enter your full name',
        email_address: 'Email Address',
        email_placeholder: 'Enter your email address',
        phone_number: 'Phone Number',
        phone_placeholder: 'Enter your phone number',
        delivery_address: 'Delivery Address',
        delivery_address_placeholder: 'Enter your full delivery address',
        preferred_delivery_time: 'Preferred Delivery Time',
        select_time: 'Select preferred time',
        morning: 'Morning (9 AM - 12 PM)',
        afternoon: 'Afternoon (12 PM - 6 PM)',
        evening: 'Evening (6 PM - 9 PM)',
        anytime: 'Anytime',
        special_instructions: 'Special Instructions',
        special_instructions_placeholder: 'Any special delivery instructions...',
        continue_to_review: 'Continue to Review',
        review_your_order: 'Review Your Order',
        review_before_confirm: 'Please review your order details before confirming',
        edit_details: 'Edit Details',
        order_items: 'Order Items',
        back_to_details: 'Back to Details',
        confirm_order: 'Confirm Order',
        order_confirmed: 'Order Confirmed!',
        order_success_message: 'Thank you for your order. We\'ll contact you shortly to confirm delivery details.',
        what_happens_next: 'What happens next:',
        step_contact: 'We\'ll contact you within 24 hours',
        step_prepare: 'We\'ll prepare your fragrances',
        step_deliver: 'Fast delivery to your address',
        continue_shopping: 'Continue Shopping',
        share_order: 'Share Order',
        order_summary: 'Order Summary',
        no_items_cart: 'No items in cart',
        add_items_first: 'Please add items to your cart first',
        browse_fragrances: 'Browse Fragrances',
        subtotal: 'Subtotal',
        delivery_fee: 'Delivery Fee',
        free_delivery: 'Free',
        total: 'Total',
        authentic_products: '100% Authentic',
        fast_delivery: 'Fast Delivery',
        secure_checkout: 'Secure Checkout',
        footer_tagline: 'Premium fragrances for discerning tastes',
        footer_contact: 'Contact: info@qotor.com',
        footer_copyright: 'Â© 2024 Qotor. All rights reserved.',
        // Validation messages
        please_fill_required: 'Please fill in all required fields',
        invalid_email: 'Please enter a valid email address',
        invalid_phone: 'Please enter a valid phone number',
        processing_order: 'Processing your order...',
        order_confirmed_success: 'Your order has been confirmed successfully!',
        failed_to_confirm: 'Failed to confirm order. Please try again.',
        connection_error: 'Connection error. Please check your internet connection.'
    },
    ar: {
        back_to_store: 'Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ù…ØªØ¬Ø±',
        customer_details: 'Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„',
        review_order: 'Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø·Ù„Ø¨',
        confirmation: 'Ø§Ù„ØªØ£ÙƒÙŠØ¯',
        customer_information: 'Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„',
        fill_details_below: 'ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ø£Ø¯Ù†Ø§Ù‡',
        full_name: 'Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„',
        full_name_placeholder: 'Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ Ø§Ù„ÙƒØ§Ù…Ù„',
        email_address: 'Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ',
        email_placeholder: 'Ø£Ø¯Ø®Ù„ Ø¹Ù†ÙˆØ§Ù† Ø¨Ø±ÙŠØ¯Ùƒ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ',
        phone_number: 'Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ',
        phone_placeholder: 'Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ù‡Ø§ØªÙÙƒ',
        delivery_address: 'Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ØªÙˆØµÙŠÙ„',
        delivery_address_placeholder: 'Ø£Ø¯Ø®Ù„ Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ØªÙˆØµÙŠÙ„ Ø§Ù„ÙƒØ§Ù…Ù„',
        preferred_delivery_time: 'ÙˆÙ‚Øª Ø§Ù„ØªÙˆØµÙŠÙ„ Ø§Ù„Ù…ÙØ¶Ù„',
        select_time: 'Ø§Ø®ØªØ± Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ÙØ¶Ù„',
        morning: 'Ø§Ù„ØµØ¨Ø§Ø­ (9 ØµØ¨Ø§Ø­Ø§Ù‹ - 12 Ø¸Ù‡Ø±Ø§Ù‹)',
        afternoon: 'Ø¨Ø¹Ø¯ Ø§Ù„Ø¸Ù‡Ø± (12 Ø¸Ù‡Ø±Ø§Ù‹ - 6 Ù…Ø³Ø§Ø¡Ù‹)',
        evening: 'Ø§Ù„Ù…Ø³Ø§Ø¡ (6 Ù…Ø³Ø§Ø¡Ù‹ - 9 Ù…Ø³Ø§Ø¡Ù‹)',
        anytime: 'Ø£ÙŠ ÙˆÙ‚Øª',
        special_instructions: 'ØªØ¹Ù„ÙŠÙ…Ø§Øª Ø®Ø§ØµØ©',
        special_instructions_placeholder: 'Ø£ÙŠ ØªØ¹Ù„ÙŠÙ…Ø§Øª Ø®Ø§ØµØ© Ù„Ù„ØªÙˆØµÙŠÙ„...',
        continue_to_review: 'Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø© Ù„Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©',
        review_your_order: 'Ø±Ø§Ø¬Ø¹ Ø·Ù„Ø¨Ùƒ',
        review_before_confirm: 'ÙŠØ±Ø¬Ù‰ Ù…Ø±Ø§Ø¬Ø¹Ø© ØªÙØ§ØµÙŠÙ„ Ø·Ù„Ø¨Ùƒ Ù‚Ø¨Ù„ Ø§Ù„ØªØ£ÙƒÙŠØ¯',
        edit_details: 'ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª',
        order_items: 'Ø¹Ù†Ø§ØµØ± Ø§Ù„Ø·Ù„Ø¨',
        back_to_details: 'Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø¨ÙŠØ§Ù†Ø§Øª',
        confirm_order: 'ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨',
        order_confirmed: 'ØªÙ… ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨!',
        order_success_message: 'Ø´ÙƒØ±Ø§Ù‹ Ù„Ùƒ Ø¹Ù„Ù‰ Ø·Ù„Ø¨Ùƒ. Ø³Ù†ØªÙˆØ§ØµÙ„ Ù…Ø¹Ùƒ Ù‚Ø±ÙŠØ¨Ø§Ù‹ Ù„ØªØ£ÙƒÙŠØ¯ ØªÙØ§ØµÙŠÙ„ Ø§Ù„ØªÙˆØµÙŠÙ„.',
        what_happens_next: 'Ù…Ø§ ÙŠØ­Ø¯Ø« Ø¨Ø¹Ø¯ Ø°Ù„Ùƒ:',
        step_contact: 'Ø³Ù†ØªÙˆØ§ØµÙ„ Ù…Ø¹Ùƒ Ø®Ù„Ø§Ù„ 24 Ø³Ø§Ø¹Ø©',
        step_prepare: 'Ø³Ù†Ø­Ø¶Ø± Ø¹Ø·ÙˆØ±Ùƒ',
        step_deliver: 'ØªÙˆØµÙŠÙ„ Ø³Ø±ÙŠØ¹ Ù„Ø¹Ù†ÙˆØ§Ù†Ùƒ',
        continue_shopping: 'Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„ØªØ³ÙˆÙ‚',
        share_order: 'Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ø·Ù„Ø¨',
        order_summary: 'Ù…Ù„Ø®Øµ Ø§Ù„Ø·Ù„Ø¨',
        no_items_cart: 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹Ù†Ø§ØµØ± ÙÙŠ Ø§Ù„Ø³Ù„Ø©',
        add_items_first: 'ÙŠØ±Ø¬Ù‰ Ø¥Ø¶Ø§ÙØ© Ø¹Ù†Ø§ØµØ± Ø¥Ù„Ù‰ Ø³Ù„ØªÙƒ Ø£ÙˆÙ„Ø§Ù‹',
        browse_fragrances: 'ØªØµÙØ­ Ø§Ù„Ø¹Ø·ÙˆØ±',
        subtotal: 'Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙØ±Ø¹ÙŠ',
        delivery_fee: 'Ø±Ø³ÙˆÙ… Ø§Ù„ØªÙˆØµÙŠÙ„',
        free_delivery: 'Ù…Ø¬Ø§Ù†ÙŠ',
        total: 'Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹',
        authentic_products: '100% Ø£ØµÙ„ÙŠ',
        fast_delivery: 'ØªÙˆØµÙŠÙ„ Ø³Ø±ÙŠØ¹',
        secure_checkout: 'Ø¯ÙØ¹ Ø¢Ù…Ù†',
        footer_tagline: 'Ø§Ù„Ø¹Ø·ÙˆØ± Ø§Ù„ÙØ§Ø®Ø±Ø© Ù„Ø£ØµØ­Ø§Ø¨ Ø§Ù„Ø°ÙˆÙ‚ Ø§Ù„Ø±ÙÙŠØ¹',
        footer_contact: 'Ø§Ù„ØªÙˆØ§ØµÙ„: info@qotor.com',
        footer_copyright: 'Â© 2024 Ù‚Ø·Ø±. Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©.',
        // Validation messages
        please_fill_required: 'ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©',
        invalid_email: 'ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø¹Ù†ÙˆØ§Ù† Ø¨Ø±ÙŠØ¯ Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ØµØ­ÙŠØ­',
        invalid_phone: 'ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… Ù‡Ø§ØªÙ ØµØ­ÙŠØ­',
        processing_order: 'Ø¬Ø§Ø±ÙŠ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø·Ù„Ø¨Ùƒ...',
        order_confirmed_success: 'ØªÙ… ØªØ£ÙƒÙŠØ¯ Ø·Ù„Ø¨Ùƒ Ø¨Ù†Ø¬Ø§Ø­!',
        failed_to_confirm: 'ÙØ´Ù„ ÙÙŠ ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.',
        connection_error: 'Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„. ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§ØªØµØ§Ù„Ùƒ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª.'
    }
};

// Initialize checkout page
document.addEventListener('DOMContentLoaded', function() {
    // Check if user came from cart
    const checkoutCart = sessionStorage.getItem('checkout_cart');
    if (!checkoutCart) {
        // Redirect to home if no cart data
        window.location.href = '/';
        return;
    }
    
    cart = JSON.parse(checkoutCart);
    displayCartItems();
    updateOrderTotal();
    updateLanguage();
    
    // Load saved language preference
    const savedLang = localStorage.getItem('qotor_language');
    if (savedLang) {
        currentLanguage = savedLang;
        document.getElementById('currentLang').textContent = currentLanguage.toUpperCase();
        document.body.className = currentLanguage === 'ar' ? 'rtl' : '';
        updateLanguage();
    }
    
    // Setup form event listeners
    setupEventListeners();
});

// Setup event listeners
function setupEventListeners() {
    // Form submission
    document.getElementById('customerForm').addEventListener('submit', function(e) {
        e.preventDefault();
        continueToReview();
    });
    
    // Input validation on change
    const inputs = document.querySelectorAll('.form-input, .form-textarea');
    inputs.forEach(input => {
        input.addEventListener('blur', validateField);
        input.addEventListener('input', clearFieldError);
    });
}

// Language switching
function toggleLanguage() {
    currentLanguage = currentLanguage === 'en' ? 'ar' : 'en';
    localStorage.setItem('qotor_language', currentLanguage);
    
    // Update language button
    document.getElementById('currentLang').textContent = currentLanguage.toUpperCase();
    
    // Update body direction
    document.body.className = currentLanguage === 'ar' ? 'rtl' : '';
    
    // Update all translated elements
    updateLanguage();
}

// Update language for all elements
function updateLanguage() {
    const elements = document.querySelectorAll('[data-key]');
    elements.forEach(element => {
        const key = element.getAttribute('data-key');
        if (translations[currentLanguage] && translations[currentLanguage][key]) {
            element.textContent = translations[currentLanguage][key];
        }
    });
    
    // Update placeholders
    const placeholderElements = document.querySelectorAll('[data-key-placeholder]');
    placeholderElements.forEach(element => {
        const key = element.getAttribute('data-key-placeholder');
        if (translations[currentLanguage] && translations[currentLanguage][key]) {
            element.placeholder = translations[currentLanguage][key];
        }
    });
    
    // Update option elements
    const optionElements = document.querySelectorAll('option[data-key]');
    optionElements.forEach(element => {
        const key = element.getAttribute('data-key');
        if (translations[currentLanguage] && translations[currentLanguage][key]) {
            element.textContent = translations[currentLanguage][key];
        }
    });
}

// Display cart items in summary
function displayCartItems() {
    const cartItems = document.getElementById('cartItems');
    const emptyCart = document.getElementById('emptyCart');
    const orderTotal = document.getElementById('orderTotal');
    
    if (cart.length === 0) {
        cartItems.style.display = 'none';
        emptyCart.style.display = 'block';
        orderTotal.style.display = 'none';
        return;
    }
    
    cartItems.style.display = 'block';
    emptyCart.style.display = 'none';
    orderTotal.style.display = 'block';
    
    cartItems.innerHTML = cart.map(item => {
        const displayName = item.fragranceBrand ? 
            `${item.fragranceBrand} ${item.fragranceName}` : 
            item.fragranceName;
        
        const itemTotal = (item.variantPrice * item.quantity).toFixed(3);
        
        return `
            <div class="cart-item">
                <div class="cart-item-image">
                    ${item.fragranceImage ? 
                        `<img src="${item.fragranceImage}" alt="${item.fragranceName}" onerror="this.src='/api/image/placeholder-fragrance.png'">` : 
                        `<img src="/api/image/placeholder-fragrance.png" alt="${item.fragranceName}">`
                    }
                </div>
                <div class="cart-item-details">
                    <div class="cart-item-name">${displayName}</div>
                    <div class="cart-item-variant">${item.variantSize} Ã— ${item.quantity}</div>
                </div>
                <div class="cart-item-price">${itemTotal} OMR</div>
            </div>
        `;
    }).join('');
}

// Update order total
function updateOrderTotal() {
    const subtotal = cart.reduce((sum, item) => sum + (item.variantPrice * item.quantity), 0);
    document.getElementById('subtotalAmount').textContent = `${subtotal.toFixed(3)} OMR`;
    document.getElementById('totalAmount').textContent = `${subtotal.toFixed(3)} OMR`;
}

// Field validation
function validateField(e) {
    const field = e.target;
    const value = field.value.trim();
    const fieldId = field.id;
    
    // Clear previous error
    clearFieldError(e);
    
    if (!value && field.required) {
        showFieldError(field, translations[currentLanguage]['please_fill_required']);
        return false;
    }
    
    // Email validation
    if (fieldId === 'email' && value && !isValidEmail(value)) {
        showFieldError(field, translations[currentLanguage]['invalid_email']);
        return false;
    }
    
    // Phone validation (basic)
    if (fieldId === 'phone' && value && value.length < 8) {
        showFieldError(field, translations[currentLanguage]['invalid_phone']);
        return false;
    }
    
    return true;
}

function clearFieldError(e) {
    const field = e.target;
    field.classList.remove('error');
    
    // Remove error message
    const errorElement = field.parentElement.querySelector('.field-error');
    if (errorElement) {
        errorElement.remove();
    }
}

function showFieldError(field, message) {
    field.classList.add('error');
    
    // Add error message
    const errorElement = document.createElement('div');
    errorElement.className = 'field-error';
    errorElement.textContent = message;
    errorElement.style.cssText = `
        color: var(--error);
        font-size: 0.875rem;
        margin-top: 0.25rem;
    `;
    
    field.parentElement.appendChild(errorElement);
}

// Email validation helper
function isValidEmail(email) {
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    return emailRegex.test(email);
}

// Continue to review step
function continueToReview() {
    if (!validateCustomerForm()) {
        return;
    }
    
    // Store customer data
    customerData = {
        name: document.getElementById('fullName').value.trim(),
        email: document.getElementById('email').value.trim(),
        phone: document.getElementById('phone').value.trim(),
        address: document.getElementById('address').value.trim(),
        deliveryTime: document.getElementById('deliveryTime').value,
        instructions: document.getElementById('instructions').value.trim()
    };
    
    // Display customer review
    displayCustomerReview();
    displayOrderReview();
    
    // Switch to step 2
    showStep(2);
}

// Validate customer form
function validateCustomerForm() {
    const requiredFields = ['fullName', 'email', 'phone', 'address'];
    let isValid = true;
    
    for (const fieldId of requiredFields) {
        const field = document.getElementById(fieldId);
        if (!validateField({ target: field })) {
            isValid = false;
            if (!field.parentElement.querySelector('.field-error')) {
                field.focus();
            }
        }
    }
    
    if (!isValid) {
        showMessage(translations[currentLanguage]['please_fill_required'], 'error');
    }
    
    return isValid;
}

// Display customer review
function displayCustomerReview() {
    const reviewContainer = document.getElementById('customerReview');
    
    const deliveryTimeText = {
        'morning': translations[currentLanguage]['morning'],
        'afternoon': translations[currentLanguage]['afternoon'],
        'evening': translations[currentLanguage]['evening'],
        'anytime': translations[currentLanguage]['anytime'],
        '': 'Not specified'
    };
    
    reviewContainer.innerHTML = `
        <div class="review-detail">
            <span class="review-label">${translations[currentLanguage]['full_name']}:</span>
            <span class="review-value">${customerData.name}</span>
        </div>
        <div class="review-detail">
            <span class="review-label">${translations[currentLanguage]['email_address']}:</span>
            <span class="review-value">${customerData.email}</span>
        </div>
        <div class="review-detail">
            <span class="review-label">${translations[currentLanguage]['phone_number']}:</span>
            <span class="review-value">${customerData.phone}</span>
        </div>
        <div class="review-detail">
            <span class="review-label">${translations[currentLanguage]['delivery_address']}:</span>
            <span class="review-value">${customerData.address}</span>
        </div>
        <div class="review-detail">
            <span class="review-label">${translations[currentLanguage]['preferred_delivery_time']}:</span>
            <span class="review-value">${deliveryTimeText[customerData.deliveryTime]}</span>
        </div>
        ${customerData.instructions ? `
            <div class="review-detail">
                <span class="review-label">${translations[currentLanguage]['special_instructions']}:</span>
                <span class="review-value">${customerData.instructions}</span>
            </div>
        ` : ''}
    `;
}

// Display order review
function displayOrderReview() {
    const reviewContainer = document.getElementById('orderReview');
    
    reviewContainer.innerHTML = cart.map(item => {
        const displayName = item.fragranceBrand ? 
            `${item.fragranceBrand} ${item.fragranceName}` : 
            item.fragranceName;
        
        const itemTotal = (item.variantPrice * item.quantity).toFixed(3);
        
        return `
            <div class="review-item">
                <div class="review-item-image">
                    ${item.fragranceImage ? 
                        `<img src="${item.fragranceImage}" alt="${item.fragranceName}" onerror="this.src='/api/image/placeholder-fragrance.png'">` : 
                        `<img src="/api/image/placeholder-fragrance.png" alt="${item.fragranceName}">`
                    }
                </div>
                <div class="review-item-details">
                    <div class="review-item-name">${displayName}</div>
                    <div class="review-item-variant">${item.variantSize} Ã— ${item.quantity}</div>
                </div>
                <div class="review-item-price">${itemTotal} OMR</div>
            </div>
        `;
    }).join('');
}

// Show specific step
function showStep(stepNumber) {
    // Hide all steps
    document.querySelectorAll('.form-step').forEach(step => {
        step.classList.remove('active');
    });
    
    // Show target step
    document.getElementById(`step${stepNumber}`).classList.add('active');
    currentStep = stepNumber;
    
    // Update progress indicators
    updateProgressSteps(stepNumber);
    
    // Scroll to top
    window.scrollTo(0, 0);
}

// Update progress steps
function updateProgressSteps(activeStep) {
    for (let i = 1; i <= 3; i++) {
        const stepElement = document.getElementById(`step${i}Progress`);
        stepElement.classList.remove('active', 'completed');
        
        if (i < activeStep) {
            stepElement.classList.add('completed');
        } else if (i === activeStep) {
            stepElement.classList.add('active');
        }
    }
}

// Edit details (go back to step 1)
function editDetails() {
    showStep(1);
}

// Back to details
function backToDetails() {
    showStep(1);
}

// Confirm order
async function confirmOrder() {
    if (cart.length === 0) {
        showMessage(translations[currentLanguage]['add_items_first'], 'error');
        return;
    }
    
    const confirmBtn = document.getElementById('confirmOrderBtn');
    const originalText = confirmBtn.querySelector('span').textContent;
    
    // Set loading state
    confirmBtn.disabled = true;
    confirmBtn.querySelector('span').textContent = translations[currentLanguage]['processing_order'];
    
    try {
        // Prepare order data
        const orderData = {
            customer: customerData,
            items: cart,
            orderDate: new Date().toISOString(),
            subtotal: cart.reduce((sum, item) => sum + (item.variantPrice * item.quantity), 0),
            deliveryFee: 0,
            total: cart.reduce((sum, item) => sum + (item.variantPrice * item.quantity), 0)
        };
        
        // Send order to API
        const response = await fetch('/api/orders', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(orderData)
        });
        
        if (response.ok) {
            // Clear cart data
            sessionStorage.removeItem('checkout_cart');
            localStorage.removeItem('qotor_cart');
            
            // Show success page
            showStep(3);
            showMessage(translations[currentLanguage]['order_confirmed_success'], 'success');
        } else {
            const errorData = await response.json();
            throw new Error(errorData.error || 'Failed to place order');
        }
        
    } catch (error) {
        console.error('Order confirmation error:', error);
        showMessage(translations[currentLanguage]['failed_to_confirm'], 'error');
        
        // Reset button
        confirmBtn.disabled = false;
        confirmBtn.querySelector('span').textContent = originalText;
    }
}

// Share order function
function shareOrder() {
    if (navigator.share) {
        navigator.share({
            title: 'Qotor Order Confirmed',
            text: 'I just ordered premium fragrances from Qotor!',
            url: window.location.origin
        });
    } else {
        // Fallback to WhatsApp
        const message = encodeURIComponent('I just ordered premium fragrances from Qotor! Check them out: ' + window.location.origin);
        window.open(`https://wa.me/?text=${message}`, '_blank');
    }
}

// Show message
function showMessage(text, type = 'error') {
    const messageEl = document.getElementById('message');
    messageEl.innerHTML = `
        <img src="/api/image/${type}-icon.png" alt="${type}" style="width: 20px; height: 20px;" onerror="this.style.display='none';">
        <span>${text}</span>
    `;
    messageEl.className = `message ${type} show`;
    
    // Auto hide after 5 seconds
    setTimeout(() => {
        messageEl.classList.remove('show');
    }, 5000);
    
    // Scroll to message
    messageEl.scrollIntoView({ behavior: 'smooth', block: 'center' });
}

// Handle browser back button
window.addEventListener('popstate', function(e) {
    if (currentStep === 2) {
        showStep(1);
    } else if (currentStep === 3) {
        // Prevent going back from success page
        window.history.pushState(null, null, window.location.href);
    } else {
        window.location.href = '/';
    }
});

// Prevent leaving page during order processing
window.addEventListener('beforeunload', function(e) {
    const confirmBtn = document.getElementById('confirmOrderBtn');
    if (confirmBtn && confirmBtn.disabled && currentStep === 2) {
        e.preventDefault();
        e.returnValue = '';
        return '';
    }
});

// Keyboard shortcuts
document.addEventListener('keydown', function(e) {
    // Language toggle with Ctrl/Cmd + L
    if ((e.ctrlKey || e.metaKey) && e.key === 'l') {
        e.preventDefault();
        toggleLanguage();
    }
    
    // Navigate steps with arrow keys
    if (e.altKey) {
        if (e.key === 'ArrowRight' && currentStep < 3) {
            e.preventDefault();
            if (currentStep === 1) {
                continueToReview();
            } else if (currentStep === 2) {
                confirmOrder();
            }
        } else if (e.key === 'ArrowLeft' && currentStep > 1) {
            e.preventDefault();
            showStep(currentStep - 1);
        }
    }
});

// Auto-save form data
function autoSaveFormData() {
    const formData = {
        fullName: document.getElementById('fullName').value,
        email: document.getElementById('email').value,
        phone: document.getElementById('phone').value,
        address: document.getElementById('address').value,
        deliveryTime: document.getElementById('deliveryTime').value,
        instructions: document.getElementById('instructions').value
    };
    
    sessionStorage.setItem('checkout_form_data', JSON.stringify(formData));
}

// Restore form data
function restoreFormData() {
    const savedData = sessionStorage.getItem('checkout_form_data');
    if (savedData) {
        const formData = JSON.parse(savedData);
        Object.keys(formData).forEach(key => {
            const element = document.getElementById(key);
            if (element && formData[key]) {
                element.value = formData[key];
            }
        });
    }
}

// Setup auto-save
document.addEventListener('DOMContentLoaded', function() {
    restoreFormData();
    
    // Auto-save on input
    const formInputs = document.querySelectorAll('.form-input, .form-textarea, .form-select');
    formInputs.forEach(input => {
        input.addEventListener('input', autoSaveFormData);
        input.addEventListener('change', autoSaveFormData);
    });
});

// Clear saved form data on successful order
function clearSavedFormData() {
    sessionStorage.removeItem('checkout_form_data');
}

// Add to order confirmation success
function onOrderSuccess() {
    clearSavedFormData();
    // Analytics tracking could go here
    if (typeof gtag !== 'undefined') {
        gtag('event', 'purchase', {
            'transaction_id': Date.now().toString(),
            'value': cart.reduce((sum, item) => sum + (item.variantPrice * item.quantity), 0),
            'currency': 'OMR'
        });
    }
}

// Handle connection issues
window.addEventListener('online', function() {
    showMessage('Connection restored', 'success');
});

window.addEventListener('offline', function() {
    showMessage(translations[currentLanguage]['connection_error'], 'error');
});

// Smooth scrolling for anchor links
document.querySelectorAll('a[href^="#"]').forEach(anchor => {
    anchor.addEventListener('click', function (e) {
        e.preventDefault();
        const target = document.querySelector(this.getAttribute('href'));
        if (target) {
            target.scrollIntoView({
                behavior: 'smooth',
                block: 'start'
            });
        }
    });
});
    </script>
</body>
</html>