<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Checkout - Qotore</title>
    <meta name="description" content="Complete your order at Qotore - Premium fragrances delivered to your door">
    
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    
    <link rel="stylesheet" href="/checkout-assets/checkout-styles.css">
</head>
<body>
    <!-- Loading Splash -->
    <div id="loadingSplash" class="loading-splash">
        <div class="loading-content">
                <img src="/icons/icon-32x32.png" alt="Qotore" class="logo-icon">
            <div class="loading-spinner"></div>
            <p data-translate="loading">Loading...</p>
        </div>
    </div>

    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <a href="/" class="logo">
                <img src="/icons/icon-32x32.png" alt="Qotore" class="logo-icon">
                <span data-translate="qotore">Qotore</span>
            </a>
            
            <div class="nav-buttons">
                <button class="nav-btn" onclick="window.location.href='/'">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
                        <polyline points="9,22 9,12 15,12 15,22"/>
                    </svg>
                    <span data-translate="home">Home</span>
                </button>
                
                <div class="user-section" id="userSection">
                    <!-- User info will be populated here -->
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Page Title -->
        <div class="page-title">
            <h1 data-translate="checkout_title">Complete Your Order</h1>
            <p data-translate="checkout_subtitle">Review your items and delivery information</p>
        </div>

        <!-- Cart & Order Container -->
        <div class="checkout-container" id="checkoutContainer">
            
            <!-- Not Signed In Message -->
            <div id="notSignedInMessage" class="not-signed-in" style="display: none;">
                <div class="status-icon">üîê</div>
                <h2 data-translate="login_required">Login Required</h2>
                <p data-translate="login_required_message">Please sign in to complete your order</p>
                <div class="action-buttons">
                    <button class="btn btn-primary" onclick="window.location.href='/user/login.html'">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"/>
                            <polyline points="10,17 15,12 10,7"/>
                            <line x1="15" y1="12" x2="3" y2="12"/>
                        </svg>
                        <span data-translate="sign_in">Sign In</span>
                    </button>
                    <button class="btn btn-secondary" onclick="window.location.href='/'">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
                            <polyline points="9,22 9,12 15,12 15,22"/>
                        </svg>
                        <span data-translate="continue_shopping">Continue Shopping</span>
                    </button>
                </div>
            </div>

            <!-- Profile Incomplete Message -->
            <div id="profileIncompleteMessage" class="profile-incomplete" style="display: none;">
                <div class="status-icon">üìù</div>
                <h2 data-translate="profile_incomplete">Complete Your Profile</h2>
                <p data-translate="profile_incomplete_message">Please complete your profile to place orders</p>
                <div class="action-buttons">
                    <button class="btn btn-primary" onclick="window.location.href='/user/register.html'">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                            <circle cx="12" cy="7" r="4"/>
                        </svg>
                        <span data-translate="complete_profile">Complete Profile</span>
                    </button>
                </div>
            </div>

            <!-- Active Order Display -->
            <div id="activeOrderDisplay" class="active-order" style="display: none;">
                <!-- Active order will be rendered here -->
            </div>

            <!-- Empty Cart -->
            <div id="emptyCartDisplay" class="empty-cart" style="display: none;">
                <div class="status-icon">üõí</div>
                <h2 data-translate="cart_empty">Your Cart is Empty</h2>
                <p data-translate="cart_empty_message">Add some fragrances to get started</p>
                <button class="btn btn-primary" onclick="window.location.href='/'">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="8" cy="21" r="1"/>
                        <circle cx="19" cy="21" r="1"/>
                        <path d="m2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12"/>
                    </svg>
                    <span data-translate="browse_fragrances">Browse Fragrances</span>
                </button>
            </div>

            <!-- Checkout Form -->
            <div id="checkoutForm" class="checkout-form" style="display: none;">
                <div class="checkout-sections">
                    <!-- Cart Items Section -->
                    <section class="cart-section">
                        <div class="section-header">
                            <h2>
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <circle cx="8" cy="21" r="1"/>
                                    <circle cx="19" cy="21" r="1"/>
                                    <path d="m2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12"/>
                                </svg>
                                <span data-translate="your_items">Your Items</span>
                            </h2>
                        </div>
                        <div class="cart-items" id="cartItems">
                            <!-- Cart items will be populated here -->
                        </div>
                        <div class="cart-summary">
                            <div class="summary-row">
                                <span data-translate="subtotal">Subtotal:</span>
                                <span id="subtotalAmount">0.000 OMR</span>
                            </div>
                            <div class="summary-row total-row">
                                <span data-translate="total">Total:</span>
                                <span id="totalAmount">0.000 OMR</span>
                            </div>
                        </div>
                    </section>

                    <!-- Delivery Information Section -->
                    <section class="delivery-section">
                        <div class="section-header">
                            <h2>
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="m21 16-4 4-4-4"/>
                                    <path d="M17 20V4h4"/>
                                    <path d="m3 8 4-4 4 4"/>
                                    <path d="M7 4v16"/>
                                </svg>
                                <span data-translate="delivery_information">Delivery Information</span>
                            </h2>
                        </div>
                        
                        <form id="deliveryForm" class="delivery-form">
                            <div class="form-group">
                                <label for="wilayat" data-translate="wilayat">Wilayat</label>
                                <select id="wilayat" name="wilayat" required>
                                    <option value="" data-translate="select_wilayat">Select your Wilayat</option>
                                    <option value="Muscat">Muscat</option>
                                    <option value="Seeb">Seeb</option>
                                    <option value="Bawshar">Bawshar</option>
                                    <option value="Amerat">Amerat</option>
                                    <option value="Quriyat">Quriyat</option>
                                    <option value="Muttrah">Muttrah</option>
                                    <option value="As Suwayq">As Suwayq</option>
                                    <option value="Nizwa">Nizwa</option>
                                    <option value="Sohar">Sohar</option>
                                    <option value="Salalah">Salalah</option>
                                    <option value="Sur">Sur</option>
                                    <option value="Ibra">Ibra</option>
                                    <option value="Rustaq">Rustaq</option>
                                    <option value="Bahla">Bahla</option>
                                    <option value="Ibri">Ibri</option>
                                    <option value="Saham">Saham</option>
                                    <option value="Barka">Barka</option>
                                    <option value="Nakhl">Nakhl</option>
                                    <option value="Wadi al Maawil">Wadi al Maawil</option>
                                    <option value="Bidbid">Bidbid</option>
                                    <option value="Other">Other</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label for="city" data-translate="city">City/Area</label>
                                <input type="text" id="city" name="city" 
                                       data-translate-placeholder="city_placeholder" 
                                       placeholder="Enter your city or area" required>
                            </div>

                            <div class="form-group">
                                <label data-translate="delivery_type">Delivery Type</label>
                                <div class="delivery-options">
                                    <label class="delivery-option">
                                        <input type="radio" name="delivery_type" value="home" checked>
                                        <div class="option-content">
                                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
                                                <polyline points="9,22 9,12 15,12 15,22"/>
                                            </svg>
                                            <span data-translate="home_delivery">Home Delivery</span>
                                        </div>
                                    </label>
                                    <label class="delivery-option">
                                        <input type="radio" name="delivery_type" value="service">
                                        <div class="option-content">
                                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <rect width="20" height="8" x="2" y="14" rx="2"/>
                                                <path d="M6 14V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v10"/>
                                                <path d="M12 7h.01"/>
                                            </svg>
                                            <span data-translate="delivery_service">Delivery Service</span>
                                        </div>
                                    </label>
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="notes" data-translate="notes">Notes (Optional)</label>
                                <textarea id="notes" name="notes" rows="3" 
                                         data-translate-placeholder="notes_placeholder"
                                         placeholder="Special instructions, landmarks, or additional information..."></textarea>
                            </div>
                        </form>
                    </section>

                    <!-- Order Actions -->
                    <section class="order-actions">
                        <button id="placeOrderBtn" class="btn btn-primary btn-large">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M9 12l2 2 4-4"/>
                                <path d="M21 12c-1 0-3-1-3-3s2-3 3-3 3 1 3 3-2 3-3 3"/>
                                <path d="M3 12c1 0 3-1 3-3s-2-3-3-3-3 1-3 3 2 3 3 3"/>
                                <path d="M12 3c0 1-1 3-3 3s-3-2-3-3 1-3 3-3 3 2 3 3"/>
                                <path d="M12 21c0-1 1-3 3-3s3 2 3 3-1 3-3 3-3-2-3-3"/>
                            </svg>
                            <span data-translate="place_order">Place Order</span>
                        </button>
                    </section>
                </div>
            </div>
        </div>
    </main>

    <!-- Invoice Modal -->
    <div id="invoiceModal" class="modal">
        <div class="modal-content invoice-modal">
            <div class="modal-header">
                <h2 data-translate="order_invoice">Order Invoice</h2>
                <button class="modal-close" onclick="closeInvoiceModal()">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"/>
                        <line x1="6" y1="6" x2="18" y2="18"/>
                    </svg>
                </button>
            </div>
            <div class="modal-body" id="invoiceContent">
                <!-- Invoice content will be populated here -->
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeInvoiceModal()" data-translate="close">Close</button>
                <button class="btn btn-primary" onclick="printInvoice()">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="6,9 6,2 18,2 18,9"/>
                        <path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"/>
                        <rect width="12" height="8" x="6" y="14"/>
                    </svg>
                    <span data-translate="print">Print</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Success Modal -->
    <div id="successModal" class="modal">
        <div class="modal-content success-modal">
            <div class="modal-body">
                <div class="success-icon">‚úÖ</div>
                <h2 data-translate="order_placed">Order Placed Successfully!</h2>
                <p data-translate="order_confirmation">We've received your order and will contact you soon with confirmation details.</p>
                <div class="success-actions">
                    <button class="btn btn-primary" onclick="window.location.href='/user/v1/orders.html'">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                            <polyline points="14,2 14,8 20,8"/>
                            <line x1="16" y1="13" x2="8" y2="13"/>
                            <line x1="16" y1="17" x2="8" y2="17"/>
                            <polyline points="10,9 9,9 8,9"/>
                        </svg>
                        <span data-translate="view_orders">View My Orders</span>
                    </button>
                    <button class="btn btn-secondary" onclick="window.location.href='/'">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
                            <polyline points="9,22 9,12 15,12 15,22"/>
                        </svg>
                        <span data-translate="continue_shopping">Continue Shopping</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div id="toastContainer" class="toast-container"></div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2?v=1.0"></script>
    <script src="/checkout-assets/checkout-translations.js"></script>
    <script src="/checkout-assets/email-notification-adapter.js"></script>
    <script src="/checkout-assets/checkout-script.js"></script>
</body>
</html>