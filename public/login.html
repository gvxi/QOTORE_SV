<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login - Qotor</title>
   <style>
      :root {
    --primary-color: #1a237e;
    --primary-light: #3949ab;
    --secondary-color: #ffd700;
    --text-primary: #212121;
    --text-secondary: #757575;
    --background: #ffffff;
    --surface: #f5f5f5;
    --border: #e0e0e0;
    --success: #4caf50;
    --error: #f44336;
    --warning: #ff9800;
    --spacing-xs: 0.25rem;
    --spacing-sm: 0.5rem;
    --spacing-md: 1rem;
    --spacing-lg: 1.5rem;
    --spacing-xl: 2rem;
    --spacing-xxl: 3rem;
    --radius-sm: 4px;
    --radius-md: 8px;
    --radius-lg: 12px;
    --radius-xl: 16px;
    --transition: 0.3s ease;
    --shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
    --shadow-lg: 0 8px 32px rgba(0, 0, 0, 0.15);
}

* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: 'Arial', 'Helvetica', sans-serif;
    line-height: 1.6;
    color: var(--text-primary);
    background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-light) 100%);
    min-height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: var(--spacing-lg);
}

.login-container {
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(20px);
    border-radius: var(--radius-xl);
    box-shadow: var(--shadow-lg);
    padding: var(--spacing-xxl);
    width: 100%;
    max-width: 400px;
    border: 1px solid rgba(255, 255, 255, 0.2);
}

.form-header {
    text-align: center;
    margin-bottom: var(--spacing-xxl);
}

.logo {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: var(--spacing-sm);
    margin-bottom: var(--spacing-lg);
}

.logo-image {
    height: 40px;
    width: auto;
}

.logo-text {
    font-size: 1.5rem;
    font-weight: bold;
    color: var(--primary-color);
}

.form-title {
    font-size: 1.75rem;
    font-weight: bold;
    color: var(--text-primary);
}

.message {
    padding: var(--spacing-md);
    border-radius: var(--radius-lg);
    margin-bottom: var(--spacing-lg);
    font-weight: 500;
    display: none;
    align-items: center;
    gap: var(--spacing-sm);
}

.message.show {
    display: flex;
}

.message.success {
    background: rgba(76, 175, 80, 0.1);
    color: var(--success);
    border: 1px solid rgba(76, 175, 80, 0.3);
}

.message.error {
    background: rgba(244, 67, 54, 0.1);
    color: var(--error);
    border: 1px solid rgba(244, 67, 54, 0.3);
}

.message.warning {
    background: rgba(255, 152, 0, 0.1);
    color: var(--warning);
    border: 1px solid rgba(255, 152, 0, 0.3);
}

.form {
    display: flex;
    flex-direction: column;
    gap: var(--spacing-lg);
}

.form-group {
    display: flex;
    flex-direction: column;
}

.input-container {
    position: relative;
    display: flex;
    align-items: center;
}

.input-icon {
    position: absolute;
    left: var(--spacing-md);
    width: 20px;
    height: 20px;
    opacity: 0.6;
    z-index: 1;
}

.form-input {
    width: 100%;
    padding: var(--spacing-lg) var(--spacing-md) var(--spacing-lg) 3rem;
    border: 2px solid var(--border);
    border-radius: var(--radius-lg);
    font-size: 1rem;
    background: var(--background);
    color: var(--text-primary);
    transition: all var(--transition);
    font-family: inherit;
}

.form-input:focus {
    outline: none;
    border-color: var(--primary-color);
    box-shadow: 0 0 0 3px rgba(26, 35, 126, 0.1);
}

.form-input::placeholder {
    color: var(--text-secondary);
}

.form-input.error {
    border-color: var(--error);
    box-shadow: 0 0 0 3px rgba(244, 67, 54, 0.1);
}

.toggle-password {
    position: absolute;
    right: var(--spacing-md);
    background: none;
    border: none;
    cursor: pointer;
    padding: var(--spacing-sm);
    border-radius: var(--radius-sm);
    transition: background var(--transition);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 1;
}

.toggle-password:hover {
    background: rgba(0, 0, 0, 0.05);
}

.eye-icon {
    width: 18px;
    height: 18px;
    opacity: 0.6;
}

.login-btn {
    background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-light) 100%);
    color: white;
    border: none;
    padding: var(--spacing-lg) var(--spacing-xl);
    border-radius: var(--radius-lg);
    font-size: 1.1rem;
    font-weight: bold;
    cursor: pointer;
    transition: all var(--transition);
    display: flex;
    align-items: center;
    justify-content: center;
    gap: var(--spacing-sm);
    position: relative;
    overflow: hidden;
    margin-top: var(--spacing-md);
    min-height: 56px;
}

.login-btn:hover:not(:disabled) {
    transform: translateY(-2px);
    box-shadow: var(--shadow);
}

.login-btn:disabled {
    opacity: 0.7;
    cursor: not-allowed;
    transform: none;
}

.btn-text {
    position: relative;
    z-index: 1;
}

.btn-icon {
    width: 20px;
    height: 20px;
    filter: brightness(0) invert(1);
    transition: transform var(--transition);
}

.login-btn:hover .btn-icon {
    transform: translateX(4px);
}

.login-btn.loading {
    pointer-events: none;
}

.login-btn.loading::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 20px;
    height: 20px;
    border: 2px solid rgba(255, 255, 255, 0.3);
    border-top: 2px solid white;
    border-radius: 50%;
    animation: spin 1s linear infinite;
    transform: translate(-50%, -50%);
}

.login-btn.loading .btn-text,
.login-btn.loading .btn-icon {
    opacity: 0;
}

@keyframes spin {
    0% { 
        transform: translate(-50%, -50%) rotate(0deg); 
    }
    100% { 
        transform: translate(-50%, -50%) rotate(360deg); 
    }
}

.shake {
    animation: shake 0.5s ease-in-out;
}

@keyframes shake {
    0%, 100% { 
        transform: translateX(0); 
    }
    10%, 30%, 50%, 70%, 90% { 
        transform: translateX(-5px); 
    }
    20%, 40%, 60%, 80% { 
        transform: translateX(5px); 
    }
}

/* Responsive Design */
@media (max-width: 480px) {
    body {
        padding: var(--spacing-md);
    }
    
    .login-container {
        padding: var(--spacing-xl);
        max-width: 100%;
    }
    
    .form-title {
        font-size: 1.5rem;
    }
    
    .logo-text {
        font-size: 1.25rem;
    }
    
    .form-input {
        padding: var(--spacing-md) var(--spacing-md) var(--spacing-md) 2.75rem;
        font-size: 0.95rem;
    }
    
    .login-btn {
        padding: var(--spacing-md) var(--spacing-lg);
        font-size: 1rem;
    }
}

/* Focus states for accessibility */
.form-input:focus-visible,
.login-btn:focus-visible,
.toggle-password:focus-visible {
    outline: 2px solid var(--primary-color);
    outline-offset: 2px;
}

/* High contrast mode support */
@media (prefers-contrast: high) {
    .login-container {
        background: white;
        border: 2px solid var(--text-primary);
    }
    
    .form-input {
        border-width: 2px;
    }
}

/* Reduced motion support */
@media (prefers-reduced-motion: reduce) {
    * {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
    }
}
   </style>
</head>
<body>
    <div class="login-container">
        <div class="login-form">
            <div class="form-header">
                <div class="logo">
                    <img src="/api/image/logo.png" alt="Qotor" class="logo-image" onerror="this.style.display='none';">
                    <span class="logo-text">Qotor</span>
                </div>
                <h1 class="form-title">Login</h1>
            </div>

            <div id="message" class="message"></div>

            <form class="form" id="loginForm">
                <div class="form-group">
                    <div class="input-container">
                        <img src="/api/image/user-icon.png" alt="User" class="input-icon" onerror="this.textContent='👤';">
                        <input 
                            type="text" 
                            id="username" 
                            class="form-input" 
                            placeholder="Username"
                            required
                            autocomplete="username"
                        >
                    </div>
                </div>

                <div class="form-group">
                    <div class="input-container">
                        <img src="/api/image/lock-icon.png" alt="Password" class="input-icon" onerror="this.textContent='🔒';">
                        <input 
                            type="password" 
                            id="password" 
                            class="form-input" 
                            placeholder="Password"
                            required
                            autocomplete="current-password"
                        >
                        <button type="button" class="toggle-password" onclick="togglePassword()">
                            <img src="/api/image/eye-icon.png" alt="Show" class="eye-icon" id="eyeIcon" onerror="this.textContent='👁️';">
                        </button>
                    </div>
                </div>

                <button type="submit" class="login-btn" id="loginBtn">
                    <span class="btn-text">Sign In</span>
                    <img src="/api/image/arrow-right-icon.png" alt="Login" class="btn-icon" onerror="this.textContent='→';">
                </button>
            </form>
        </div>
    </div>

    <script>
        // Global variables
let isLoading = false;

// Initialize login page
document.addEventListener('DOMContentLoaded', function() {
    // Check if already logged in
    checkExistingSession();
    
    // Setup form event listeners
    setupEventListeners();
    
    // Focus username field
    document.getElementById('username').focus();
});

// Setup event listeners
function setupEventListeners() {
    const loginForm = document.getElementById('loginForm');
    const usernameField = document.getElementById('username');
    const passwordField = document.getElementById('password');
    
    // Form submission
    loginForm.addEventListener('submit', handleLogin);
    
    // Clear error messages on input
    usernameField.addEventListener('input', clearMessages);
    passwordField.addEventListener('input', clearMessages);
    
    // Enter key handling
    usernameField.addEventListener('keydown', function(e) {
        if (e.key === 'Enter') {
            e.preventDefault();
            passwordField.focus();
        }
    });
    
    passwordField.addEventListener('keydown', function(e) {
        if (e.key === 'Enter') {
            e.preventDefault();
            handleLogin(e);
        }
    });
    
    // Input validation
    usernameField.addEventListener('blur', validateUsername);
    passwordField.addEventListener('blur', validatePassword);
}

// Check for existing session
async function checkExistingSession() {
    try {
        const response = await fetch('/api/admin/auth/verify', {
            method: 'GET',
            credentials: 'include'
        });
        
        if (response.ok) {
            // Already logged in, redirect to admin
            window.location.href = '/admin/';
        }
    } catch (error) {
        // Not logged in or error, continue with login page
        console.log('No existing session');
    }
}

// Validate username field
function validateUsername() {
    const usernameField = document.getElementById('username');
    const username = usernameField.value.trim();
    
    if (!username) {
        showFieldError(usernameField, 'Username is required');
        return false;
    }
    
    if (username.length < 3) {
        showFieldError(usernameField, 'Username must be at least 3 characters');
        return false;
    }
    
    clearFieldError(usernameField);
    return true;
}

// Validate password field
function validatePassword() {
    const passwordField = document.getElementById('password');
    const password = passwordField.value;
    
    if (!password) {
        showFieldError(passwordField, 'Password is required');
        return false;
    }
    
    if (password.length < 6) {
        showFieldError(passwordField, 'Password must be at least 6 characters');
        return false;
    }
    
    clearFieldError(passwordField);
    return true;
}

// Show field error
function showFieldError(field, message) {
    field.classList.add('error');
    
    // Remove existing error message
    const existingError = field.parentElement.parentElement.querySelector('.field-error');
    if (existingError) {
        existingError.remove();
    }
    
    // Add new error message
    const errorElement = document.createElement('div');
    errorElement.className = 'field-error';
    errorElement.textContent = message;
    errorElement.style.cssText = `
        color: var(--error);
        font-size: 0.875rem;
        margin-top: 0.5rem;
        padding-left: 1rem;
    `;
    
    field.parentElement.parentElement.appendChild(errorElement);
}

// Clear field error
function clearFieldError(field) {
    field.classList.remove('error');
    
    const errorElement = field.parentElement.parentElement.querySelector('.field-error');
    if (errorElement) {
        errorElement.remove();
    }
}

// Handle login form submission
async function handleLogin(event) {
    event.preventDefault();
    
    if (isLoading) return;
    
    const username = document.getElementById('username').value.trim();
    const password = document.getElementById('password').value;
    
    // Clear previous messages
    clearMessages();
    clearAllFieldErrors();
    
    // Validation
    const isUsernameValid = validateUsername();
    const isPasswordValid = validatePassword();
    
    if (!isUsernameValid || !isPasswordValid) {
        return;
    }
    
    // Set loading state
    setLoadingState(true);
    
    try {
        const response = await fetch('/api/admin/auth/login', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            credentials: 'include',
            body: JSON.stringify({
                username: username,
                password: password
            })
        });
        
        const data = await response.json();
        
        if (response.ok && data.success) {
            // Login successful
            showMessage('Login successful! Redirecting...', 'success');
            
            // Redirect after a short delay
            setTimeout(() => {
                window.location.href = '/admin/';
            }, 1000);
            
        } else {
            // Login failed
            const errorMessage = data.error || 'Invalid username or password';
            showMessage(errorMessage, 'error');
            
            // Add shake animation to form
            const loginContainer = document.querySelector('.login-container');
            loginContainer.classList.add('shake');
            setTimeout(() => {
                loginContainer.classList.remove('shake');
            }, 500);
            
            // Clear password field and focus it
            document.getElementById('password').value = '';
            document.getElementById('password').focus();
        }
        
    } catch (error) {
        console.error('Login error:', error);
        showMessage('Connection error. Please try again.', 'error');
    } finally {
        setLoadingState(false);
    }
}

// Set loading state
function setLoadingState(loading) {
    isLoading = loading;
    const loginBtn = document.getElementById('loginBtn');
    const usernameField = document.getElementById('username');
    const passwordField = document.getElementById('password');
    
    if (loading) {
        loginBtn.classList.add('loading');
        loginBtn.disabled = true;
        usernameField.disabled = true;
        passwordField.disabled = true;
    } else {
        loginBtn.classList.remove('loading');
        loginBtn.disabled = false;
        usernameField.disabled = false;
        passwordField.disabled = false;
    }
}

// Show message
function showMessage(text, type = 'error') {
    const messageEl = document.getElementById('message');
    
    // Add icon based on message type
    let icon = '';
    switch(type) {
        case 'success':
            icon = '<img src="/api/image/success-icon.png" alt="Success" style="width: 16px; height: 16px;" onerror="this.textContent=\'✓\'">';
            break;
        case 'error':
            icon = '<img src="/api/image/error-icon.png" alt="Error" style="width: 16px; height: 16px;" onerror="this.textContent=\'✕\'">';
            break;
        case 'warning':
            icon = '<img src="/api/image/warning-icon.png" alt="Warning" style="width: 16px; height: 16px;" onerror="this.textContent=\'⚠\'">';
            break;
    }
    
    messageEl.innerHTML = `${icon}<span>${text}</span>`;
    messageEl.className = `message ${type} show`;
    
    // Auto hide success messages after 3 seconds
    if (type === 'success') {
        setTimeout(() => {
            messageEl.classList.remove('show');
        }, 3000);
    }
}

// Clear messages
function clearMessages() {
    const messageEl = document.getElementById('message');
    messageEl.classList.remove('show');
}

// Clear all field errors
function clearAllFieldErrors() {
    const fields = ['username', 'password'];
    fields.forEach(fieldId => {
        const field = document.getElementById(fieldId);
        clearFieldError(field);
    });
}

// Toggle password visibility
function togglePassword() {
    const passwordField = document.getElementById('password');
    const eyeIcon = document.getElementById('eyeIcon');
    
    if (passwordField.type === 'password') {
        passwordField.type = 'text';
        eyeIcon.src = '/api/image/eye-off-icon.png';
        eyeIcon.alt = 'Hide';
        eyeIcon.onerror = function() { this.textContent = '🙈'; };
    } else {
        passwordField.type = 'password';
        eyeIcon.src = '/api/image/eye-icon.png';
        eyeIcon.alt = 'Show';
        eyeIcon.onerror = function() { this.textContent = '👁️'; };
    }
}

// Handle page visibility changes
document.addEventListener('visibilitychange', function() {
    if (document.visibilityState === 'visible') {
        // Check session when page becomes visible
        checkExistingSession();
    }
});

// Prevent form resubmission on page refresh
window.addEventListener('beforeunload', function(e) {
    if (isLoading) {
        e.preventDefault();
        e.returnValue = 'Login in progress. Are you sure you want to leave?';
        return e.returnValue;
    }
});

// Keyboard shortcuts
document.addEventListener('keydown', function(e) {
    // Escape key to clear form
    if (e.key === 'Escape') {
        document.getElementById('username').value = '';
        document.getElementById('password').value = '';
        clearMessages();
        clearAllFieldErrors();
        document.getElementById('username').focus();
    }
    
    // Ctrl/Cmd + Enter to submit form
    if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {
        e.preventDefault();
        if (!isLoading) {
            handleLogin(e);
        }
    }
});

// Auto-focus on username field when page loads
window.addEventListener('load', function() {
    document.getElementById('username').focus();
});

// Handle connection status
window.addEventListener('online', function() {
    showMessage('Connection restored', 'success');
    setTimeout(clearMessages, 2000);
});

window.addEventListener('offline', function() {
    showMessage('Connection lost. Please check your internet.', 'warning');
});
    </script>
</body>
</html>